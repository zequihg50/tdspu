<?xml version="1.0" encoding="UTF-8"?>
<netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2">
  <aggregation type="union">

    {% for _, files in groups -%}
    {% if files|length > 1 -%}
    <netcdf>
      <aggregation type="joinExisting" dimName="time">
	{% for file in files %}
	<netcdf location="{{ file }}" ncoords="{{ ncoords(file, 'time') }}" />
	{% endfor %}
      </aggregation>
    </netcdf>
    {% elif files|length == 1 -%}
    <netcdf location="{{ files|first }}" />
    {% endif %}
    {% endfor %}
  </aggregation>
</netcdf>
